# AWS to Oracle Cloud Migration Guide

This guide explains how to migrate your ScreenConnect deployment from AWS to Oracle Cloud Infrastructure (OCI) using the provided automation, scripts, and best practices. The process is designed to ensure a careful, secure migration that preserves all customizations and avoids direct file replacement.

---

## Overview

- **Careful merge, not direct copy:** The migration process identifies customizations and configuration differences, and guides you through a careful merge rather than a direct overwrite.
- **Automated planning:** Scripts generate a migration plan, backup, and restore scripts tailored to your environment.
- **Validation and rollback:** The process includes validation steps and a rollback plan for safety.

---

## Prerequisites

- Access to your AWS ScreenConnect server (RDP/PowerShell)
- Oracle Cloud account with API access
- Cloudflare account (for DNS)
- ScreenConnect license key
- PowerShell 5.1+ on your management workstation

---

## Migration Steps

### 1. Generate a Migration Plan

On your management workstation, run:

```powershell
cd oracle-cloud-screenconnect/scripts

# Generate a migration plan for your AWS server
./migration-plan.ps1 -Action plan -SourceServer 'your-aws-server.com' -OutputPath 'migration-plan.txt'
```

- This script will:
  - Test connectivity to your AWS server
  - Gather information about ScreenConnect, IIS, SSL, and custom files
  - Generate a detailed migration plan/checklist in `migration-plan.txt`

**Review the plan and checklist before proceeding.**

---

### 2. Backup Your AWS Server

On your AWS ScreenConnect server, run the generated backup script (or use the migration script):

```powershell
# On AWS server
cd C:\path\to\scripts

# Create a backup (script may be generated by migration-plan.ps1)
./backup-screenconnect.ps1
```

- This will create a full backup of your ScreenConnect installation, including custom files and configurations.
- Copy the backup file to a secure location and verify its integrity.

---

### 3. Prepare Oracle Cloud Environment

On your management workstation:

```powershell
# Validate prerequisites
./validate-prerequisites.ps1

# Setup secure configuration for Oracle Cloud
./setup-secure-config.ps1 -Environment 'production' -Interactive

# Edit terraform.tfvars with your actual values (tenancy OCID, domains, etc.)
```

- Follow the prompts to configure your Oracle Cloud environment.
- Ensure all required variables and secrets are set.

---

### 4. Deploy Oracle Cloud Infrastructure

In the `environments/production` directory:

```bash
terraform init
terraform plan
terraform apply
```

- This will provision the Windows VM, networking, storage, and secrets management in Oracle Cloud.

---

### 5. Restore ScreenConnect on Oracle Cloud

Copy your AWS backup file to the new Oracle Cloud VM (via RDP, WinSCP, etc.).

On the Oracle Cloud VM:

```powershell
# Run the restore script (may be generated by migration-plan.ps1)
cd C:\path\to\scripts
# Restore from backup (use ScreenConnect's built-in restore functionality)
# Or manually restore from backup files using ScreenConnect's restore process
```

- This will extract the backup and restore ScreenConnect, custom files, and configurations.
- The script will prompt you to manually review and merge configuration files if differences are detected.

---

### 6. Manual Merge of Customizations

**Important:**
- Do **not** overwrite configuration files blindly.
- Use the generated merge plan and/or `aws-migration-assistant.ps1` to compare AWS and Oracle config files.

To compare and merge configs:

```powershell
# On your management workstation
./aws-migration-assistant.ps1 -Action compare -SourceBackupPath 'C:\path\to\aws\backup' -OracleConfigPath 'C:\path\to\oracle\config'
```

- Review the generated comparison report.
- Manually merge custom settings, connection strings, and SSL configs as needed.

---

### 7. Update DNS and SSL

- Update your Cloudflare DNS records to point to the new Oracle Cloud VM.
- Run the SSL management script to issue/renew certificates:

```powershell
./ssl-management.ps1 -Domain 'remotesupport.yourdomain.com' -Email 'admin@yourdomain.com'
```

---

### 8. Validate and Cut Over

- Test all ScreenConnect functionality on the new server.
- Validate SSL, RDP, and backup systems.
- Schedule downtime and perform the final cutover:
  - Stop services on AWS
  - Final sync/backup if needed
  - Update DNS
  - Start services on Oracle Cloud

---

### 9. Post-Migration Tasks

- Monitor the new deployment for issues
- Update documentation
- Decommission AWS resources when ready

---

## Rollback Plan

If issues occur:
- Revert DNS to AWS
- Restore services on AWS
- Investigate and retry migration as needed

---

## Advanced: Automated Merge Planning

You can use the `aws-migration-assistant.ps1` script for advanced analysis and merge planning:

```powershell
# Analyze AWS server for migration requirements
./aws-migration-assistant.ps1 -Action analyze -SourceServer 'your-aws-server.com'

# Create a merge plan for configuration migration
./aws-migration-assistant.ps1 -Action merge -SourceBackupPath 'C:\path\to\aws\backup' -OracleConfigPath 'C:\path\to\oracle\config'
```

---

## References

The following scripts are provided to assist with migration:

- [migration-plan.ps1](../scripts/migration-plan.ps1): Main migration planning tool
- [aws-migration-assistant.ps1](../scripts/aws-migration-assistant.ps1): Advanced config comparison/merge tool
- [ssl-management.ps1](../scripts/ssl-management.ps1): SSL certificate management
- [setup-secure-config.ps1](../scripts/setup-secure-config.ps1): Secure config setup
- [validate-deployment.ps1](../scripts/validate-deployment.ps1): Deployment validation

---

**Always test in a non-production environment first.**

For questions, see the main README or contact project maintainers. 